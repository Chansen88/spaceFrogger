<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Calc</title>
    <link rel="stylesheet" href="/css/master.css" >
    <script src="https://fb.me/react-0.14.3.js"></script>
    <script src="https://fb.me/react-dom-0.14.3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/2.4.2/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.js"></script>
  </head>
  <body>
    <div id="container">
      <script type="text/babel">

        var id = false;
        var GameBoard = React.createClass({
          getInitialState: function() {
            return { time: 0,
                     level: 1
            };
          },

          timer () {
            clearInterval(id);
            this.setState({ time: this.state.time + 1});
            id = requestAnimationFrame(this.timer);
          },

          componentDidMount: function() {
            this.timer();
          },

          render: function() {
            return <div id="GameBoard">
              <SpaceStation />
              <Row time={this.state.time} level={this.state.level - .2} />
              <Row time={this.state.time} level={this.state.level + .3} />
              <Row time={this.state.time} level={this.state.level + .1} />
              <Row time={this.state.time} level={this.state.level + .2} />
              <Row time={this.state.time} level={this.state.level} />
              <Ship />
            </div>;
          }
        });

        var Ship = React.createClass({
          getInitialState: function() {
            return {
              locationX: 6,
              locationY: 0, //out of 12 steps
              orientation: 'ship'
            };
          },

          shipControls: function(e) {
            console.log(this.state.locationX);
            if (e.which === 37 && this.state.locationX !== 0) {
              this.setState({ orientation: 'shipL', locationX: this.state.locationX - 1})
            } else if (e.which === 38 && this.state.locationY !== 6) {
              this.setState({ orientation: 'ship', locationY: this.state.locationY + 1})
            } else if (e.which === 39 && this.state.locationX !== 12) {
              this.setState({ orientation: 'shipR', locationX: this.state.locationX + 1})
            } else if (e.which === 40 && this.state.locationY !== 0) {
              this.setState({ orientation: 'ship', locationY: this.state.locationY - 1})
            } else {
              console.log('PLEASE USE ARROW KEYS TO MOVE AROUND THE BOARD');
            }
            console.log(this.state.locationX);
          },

          componentDidMount: function() {
            document.addEventListener("keydown", this.shipControls);
          },

          render: function() {
            var locationX = Math.floor(this.state.locationX * 116.667) - 35;
            if (this.state.locationX === 0) {
              locationX = 0;
            } else if (this.state.locationX === 12) {
              locationX = 1330;
            }
            var locationY = this.state.locationY * 100;

            return <div className="startrow">
              <div id={this.state.orientation} style={{left: locationX + 'px', bottom: locationY + 'px'}}></div>
            </div>;
          }
        });

        var SpaceStation = React.createClass({
          getInitialState: function() {
            return { locaions: ''};
          },

          render: function() {
            return <div className="landingrow">
              <div className="landing"></div>
              <div className="landing"></div>
              <div className="landing"></div>
              <div className="landing"></div>
              <div className="landing"></div>
            </div>;
          }
        });

        var Astroid = React.createClass({
          getInitialState: function() {
            var select = Math.floor(Math.random()* 3);
            var size = {
                '0': 94,
                '1': 39,
                '2': 164
            };
            return { select: select,
                     location: Math.floor(Math.random()* 1400),
                     size: size[select]
            };
          },

          componentWillReceiveProps: function() {
            var nextValue = (this.state.location +(this.props.speed * this.props.direction)) % 1400;
            if (nextValue <= 0) {
              nextValue =+ 1400;
            }
            this.setState({ location: nextValue });
          },

          render: function() {
            return <div
              className={`Astroid${this.state.select}`}
              style={{left: this.state.location - (this.state.size / 3) + 'px'}}
              data-size= {this.state.size}
              >
            </div>;
          }
        });

        var Row = React.createClass({

          getInitialState: function() {
            var velocity = (2 + Math.floor(Math.random() * 3)) * this.props.level;
            var select = Math.floor(Math.random()* 2);
            var direction = {
                '0': -1,
                '1': 1
            };
            return { speed: velocity,
                     direction: direction[select],
                     number: 5 };
          },

          render: function() {
            var astroids = [];
            for (var i = 0; i < this.state.number; i++) {
              astroids.push(<Astroid time={this.props.time} speed={this.state.speed} direction={this.state.direction}/>);
            }
            return <div onClick={this.handleClick} className="row">
              {astroids}
            </div>;
          }
        });

        ReactDOM.render(
          <GameBoard />,
          document.getElementById('container')
        );
      </script>
    </div>
  </body>
</html>
